@model WEB_MEDICAL.ViewModels.DepartmentPatientView

@{
    ViewData["Title"] = "DepartmentPatient";
}

<h1>DepartmentPatient</h1>

<div class="form-horizontal">
    <div class="col-md-6">
        <div class="form-group">
            <label  class="control-label"> Department</label>
            <select name="DepartmentId" id="DepartmentId"  class="form-control" asp-items="Model.Departments">
                <option value="">--select department--</option>
            </select>
        </div>

        <div class="form-group">
            <label class="control-label">Patient</label>
            <select name="PatientId" id="PatientId" class="form-control">
                <option value="">--select Patient--</option>
            </select>
        </div>

    </div>

    <div class="col-md-6">
        @* <div>
            <h4>Patient</h4>
            <hr />
            <dl class="row">
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Id)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.Id)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.PatientName)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.PatientName)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.PatientDescription)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.PatientDescription)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.AdmitDate)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.AdmitDate)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.DepartmentId)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.DepartmentId)
                </dd>
            </dl>
        </div>
        <div>
            @Html.ActionLink("Edit", "Edit", new { /* id = Model.PrimaryKey */ }) |
            <a asp-action="Index">Back to List</a>
        </div> *@
    </div>

</div>

@section  Scripts{
    <script>
        $("#DepartmentId").change(function () {
            var departmentId = $("#DepartmentId").val();
            $("#PatientId").empty(); 
            $("#PatientId").append("<option value=''>--select Patient--</option>");
            var json = {
                did:departmentId
            };
            $.ajax({
                type:"POST",
                url: "/Patient/GetPatient",
                data: json,
                success: function (response) {
                    console.log(response);
                    var patient = response;
                    

                    $.each(patient, function (key, patient) {
                        console.log(patient);
                        var option = "<option value='" + patient.id + "'>" + patient.patientName + "</option>";
                        $("#PatientId").append(option);
                    });


                    
                },
                error: function (response) {
                    alert(response.message);
                }
               
            });
        });
    </script>
}